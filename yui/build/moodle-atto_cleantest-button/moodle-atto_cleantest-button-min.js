YUI.add("moodle-atto_cleantest-button",function(c,e){var d="atto_cleantest";c.namespace("M.atto_cleantest").Button=c.Base.create("button",c.M.editor_atto.EditorPlugin,[],{dialogue:null,initializer:function(){this.addButton({icon:"e/question",callback:this._open}).set("title",M.util.get_string("pluginname",d))},_open:function(e){e.preventDefault(),this.dialogue=this.getDialogue({modal:!1,headerContent:M.util.get_string("pluginname",d),width:"600px"});var t=c.Handlebars.compile('<div class="hide"><a class="btn btn-secondary" id="run">Run</a></div><h3>Running {{testCount}} tests</h3><div><div id="passed" class="alert alert-success alert-block">Pass</div><div id="failed" class="alert alert-danger alert-block">Fail</div></div><hr/><div id="results"></div>'),s=c.Node.create(t({testCount:this.get("tests").length}));s.one("#run").on("click",this._runTests,this),s.one("#failed").hide(),s.one("#passed").hide(),this.dialogue.set("bodyContent",s),this.dialogue.show(),this.markUpdated(),this._runTests()},_runTests:function(){var e,t=c.Handlebars.compile('<div class="codetest"><div>{{#if about}}<div>{{about}}</div>{{/if}}{{#if pass}}<div class="alert alert-success alert-block" data-toggle="collapse" href="#collapse{{testNumber}}" role="button" aria-expanded="false" aria-controls="collapse{{testNumber}}" style="padding:0.25rem 1.25rem">{{testNumber}} - Pass - Click to expand<br/></div>{{else}}<div class="alert alert-danger alert-block" data-toggle="collapse" href="#collapse{{testNumber}}" role="button" aria-expanded="true" aria-controls="collapse{{testNumber}}" style="padding:0.25rem 1.25rem">{{testNumber}} - Fail</div>{{/if}}</div><div class="collapse {{#unless pass}}show{{/unless}}" id="collapse{{testNumber}}"><div><div>Input:</div><code><pre class="codeinput">{{inputCode}}</pre></code></div><div><div>Output:</div><code><pre class="codeoutput">{{outputCode}}</pre></code></div><div><div>Expected:</div><code><pre class="codeexpected">{{expectedCode}}</pre></code></div></div><hr style="margin:0.25rem"/></div>'),s=null,d=null,a=null,i=!1,o=0,l=null,n=this.get("host"),r=this.get("tests");for(e=0;e<r.length;e++){a=r[e],d="";try{d=n._cleanHTML(a.input,!0)}catch(u){}0==d.localeCompare(a.expected)?(i=!0,0):(i=!1,o++),s=c.Node.create(t({about:a.about,inputCode:a.input,outputCode:d,expectedCode:a.expected,pass:i,testNumber:e})),this.dialogue.bodyNode.one("#results").append(s)}o?(l=o+" out of "+r.length+" tests failed!",this.dialogue.bodyNode.one("#failed").set("innerHTML",l),this.dialogue.bodyNode.one("#failed").show()):(l="All "+r.length+" tests passed!",this.dialogue.bodyNode.one("#passed").set("innerHTML",l),this.dialogue.bodyNode.one("#passed").show())},_setCode:function(e,t){this.dialogue.bodyNode.one("#"+e).set("innerHTML",c.Escape.html(t))}},{ATTRS:{tests:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin","escape"]});